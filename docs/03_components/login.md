# ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ è¦ä»¶ãƒ»è¨­è¨ˆæ›¸

## 1. è¦ä»¶

### 1.1 èªè¨¼æ–¹å¼

| æ–¹å¼ | èª¬æ˜ | ç”¨é€” |
|------|------|------|
| ID/PWèªè¨¼ | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹+ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³ | ãƒ†ã‚¹ãƒˆãƒ»é–‹ç™ºç”¨ï¼ˆç®¡ç†è€…ã®ã¿ç™ºè¡Œå¯èƒ½ï¼‰ |
| Google OAuth | Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ | æœ¬é‹ç”¨å‘ã‘ï¼ˆè¨±å¯ãƒªã‚¹ãƒˆåˆ¶å¾¡ï¼‰ |

### 1.2 èªå¯ãƒ«ãƒ¼ãƒ«

- **è¨±å¯ãƒªã‚¹ãƒˆåˆ¶å¾¡**: `allowed_emails.json` ã«ç™»éŒ²ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- ç®¡ç†è€…ãŒè¨±å¯ãƒªã‚¹ãƒˆã‚’ç·¨é›† â†’ ãƒ‡ãƒ—ãƒ­ã‚¤ã§åæ˜ 

### 1.3 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

| ã‚±ãƒ¼ã‚¹ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|--------|-----------|
| ID/PWé–“é•ã„ | ã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€ |
| OAuthè¨±å¯ãƒªã‚¹ãƒˆå¤– | ã€Œã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯è¨±å¯ãƒªã‚¹ãƒˆã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€ |

### 1.4 ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®é·ç§»

- ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ â†’ ã€Œãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ã€è¡¨ç¤º â†’ ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§ç”»é¢ã¸é·ç§»

---

## 2. æŠ€è¡“è¨­è¨ˆ

### 2.1 ä½¿ç”¨æŠ€è¡“

- **Firebase Authentication**
  - Firebase JS SDK v10.7.1 (modularç‰ˆ, ES Modules)
  - Email/Password Provider
  - Google Provider (Popup mode only)
  - **Persistence**: æ˜ç¤ºçš„ã« `LOCAL` ã‚’è¨­å®šï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ç¶­æŒï¼‰
- **èªå¯ãƒã‚§ãƒƒã‚¯**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ `allowed_emails.json` ã¨ç…§åˆ
- **Mobile Support**: Limited (Popup may be blocked or fail on some mobile browsers)

### 2.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
public/
â”œâ”€â”€ index.html           # ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ + ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§
â”œâ”€â”€ allowed_emails.json  # è¨±å¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒªã‚¹ãƒˆ
â””â”€â”€ firebase_config.json # Firebaseè¨­å®š
```

### 2.3 èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    A[ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢] --> B{èªè¨¼æ–¹å¼}
    B -->|ID/PW| C[Firebase signInWithEmailAndPassword]
    B -->|Google| D[Firebase signInWithPopup]
    C --> E{èªè¨¼æˆåŠŸ?}
    D --> E
    E -->|å¤±æ•—| F[ã‚¨ãƒ©ãƒ¼è¡¨ç¤º: ID/PWé–“é•ã„]
    E -->|æˆåŠŸ| G{è¨±å¯ãƒªã‚¹ãƒˆã«å­˜åœ¨?}
    G -->|No| H[ã‚¨ãƒ©ãƒ¼è¡¨ç¤º: è¨±å¯ãƒªã‚¹ãƒˆå¤–]
    G -->|Yes| I[ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§ã¸é·ç§»]
    H --> J[ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ]
```

### 2.4 allowed_emails.json å½¢å¼

```json
{
    "emails": [
        "nakame.kate@gmail.com",
        "sampleexample@gmail.com"
    ]
}
```

---

## 3. UIè¨­è¨ˆ

### 3.1 ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      âš½ ã‚µãƒƒã‚«ãƒ¼è¦³æˆ¦ã‚¬ã‚¤ãƒ‰        â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹            â”‚  â”‚
â”‚  â”‚  [                    ]   â”‚  â”‚
â”‚  â”‚  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰               â”‚  â”‚
â”‚  â”‚  [                    ]   â”‚  â”‚
â”‚  â”‚  [ğŸ” ãƒ­ã‚°ã‚¤ãƒ³]            â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€ ã¾ãŸã¯ â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  [G Googleã§ãƒ­ã‚°ã‚¤ãƒ³]     â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚  ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºæ¬„    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

- **èµ¤è‰²ãƒ†ã‚­ã‚¹ãƒˆ**ã§è¡¨ç¤º
- ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ä¸‹ã«é…ç½®

---

## 4. è©³ç´°ä»•æ§˜

### 4.1 ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿æŒ (Persistence)
- **Web (ãƒ–ãƒ©ã‚¦ã‚¶)**:
  - **è¨­å®š**: `LOCAL` (ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ç¶­æŒã•ã‚Œã‚‹)
  - **å®Ÿè£…**: å¸¸ã«æ˜ç¤ºçš„ã« `setPersistence(auth, browserLocalPersistence)` ã‚’å‘¼ã³å‡ºã—ã€æ°¸ç¶šåŒ–ã‚’ä¿è¨¼ã™ã‚‹ã€‚
  - **WebView (Instagram/LINEç­‰)**: ãƒ–ãƒ©ã‚¦ã‚¶ä»•æ§˜ã«ä¾å­˜ã™ã‚‹ãŒã€åŸºæœ¬çš„ã«ã¯Cookie/LocalStorageãŒã‚¯ãƒªã‚¢ã•ã‚Œãªã„é™ã‚Šç¶­æŒã•ã‚Œã‚‹ã€‚ãŸã ã—ã€ã‚¢ãƒ—ãƒªå†…ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»•æ§˜ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ã€‚

### 4.2 ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹ãƒ»åŒæ™‚ãƒ­ã‚°ã‚¤ãƒ³
- **ä»•æ§˜**: 1ã¤ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§**è¤‡æ•°ç«¯æœ«ã‹ã‚‰ã®åŒæ™‚ãƒ­ã‚°ã‚¤ãƒ³ãŒå¯èƒ½**ã€‚
- **æ’ä»–åˆ¶å¾¡**: ãªã—ï¼ˆPCã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ã‚¹ãƒãƒ›å´ã¯ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã•ã‚Œãªã„ï¼‰ã€‚å„ç«¯æœ«ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ç‹¬ç«‹ã—ã¦ç®¡ç†ã•ã‚Œã‚‹ã€‚
- **ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã® `signOut()` ã¯ã€**æ“ä½œã—ãŸç«¯æœ«ã®ã¿**ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹ã€‚å…¨ç«¯æœ«ä¸€æ–‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ã¯å®Ÿè£…ã—ãªã„ã€‚

---

## 5. Firebase Console è¨­å®š

ç®¡ç†ç”»é¢: https://console.firebase.google.com/u/0/project/football-delay-watching-a8830/authentication/providers

### 5.1 å¿…é ˆè¨­å®š (Authentication)

1.  **Sign-in method (ãƒ—ãƒ­ãƒã‚¤ãƒ€è¨­å®š)**
    -   **Email/Password**: `Enabled` (æœ‰åŠ¹)
        -   Email link (passwordless sign-in): `Disabled`
    -   **Google**: `Enabled` (æœ‰åŠ¹)
        -   Web SDK configuration: Client ID / Secret ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆGCPé€£æºæ™‚ã«è‡ªå‹•è¨­å®šã•ã‚Œã‚‹ãŒè¦ç¢ºèªï¼‰

2.  **Settings (å…¨èˆ¬è¨­å®š)**
    -   **Authorized domains (æ‰¿èªæ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³)**
        -   `football-delay-watching-a8830.web.app` (æœ¬ç•ª)
        -   `football-delay-watching-a8830.firebaseapp.com` (æœ¬ç•ªã‚¨ã‚¤ãƒªã‚¢ã‚¹)
        -   `localhost` (ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨)
        -   *(Option)* ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã“ã“ã«è¿½åŠ å¿…é ˆ

3.  **Advanced (é«˜åº¦ãªè¨­å®š)**
    -   **Account Linking (ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒªãƒ³ã‚¯)**
        -   é€šå¸¸ã¯ã€ŒåŒã˜ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªãƒ³ã‚¯ã™ã‚‹ã€ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã€‚
        -   Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨Email/PWã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§åŒã˜ãƒ¡ã‚¢ãƒ‰ãŒä½¿ã‚ã‚ŒãŸå ´åˆã€1ã¤ã®UIDã«çµ±åˆã•ã‚Œã‚‹è¨­å®šãŒæœ›ã¾ã—ã„ã€‚

### 5.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ æ‰‹é †

1.  `public/allowed_emails.json` ã«è¨±å¯ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ 
2.  `firebase deploy --only hosting` ã§ãƒ‡ãƒ—ãƒ­ã‚¤
3.  Email/Passwordèªè¨¼ã‚’ä½¿ã†å ´åˆã¯ã€Firebase Console > Authentication > Users ã§äº‹å‰ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹

### 5.3 Hosting è¨­å®š
- **Hosting URL**: `https://football-delay-watching-a8830.web.app`
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: CLI (`firebase deploy`) çµŒç”±ã§é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`public/`ï¼‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚

---

## 6. æ—¢çŸ¥ã®èª²é¡Œ

| èª²é¡Œ | å¯¾å¿œçŠ¶æ³ | Issue |
|------|----------|-------|
| Email/Passwordèªè¨¼ãŒæ©Ÿèƒ½ã—ãªã„ | æœªå¯¾å¿œ | [#183](https://github.com/igrekplus/football-delay-watching/issues/183) |
| Firebase SDK v8 â†’ v9 ç§»è¡Œ | å¯¾å¿œæ¸ˆã¿ | [#184](https://github.com/igrekplus/football-delay-watching/issues/184) |
| `allowed_emails.json` ã®å…¬é–‹éœ²å‡º | è¨±å®¹ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–æ¸ˆã¿ï¼‰ | - |

