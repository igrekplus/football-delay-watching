# 同国対決トリビア生成仕様 (Issue #39)

本ドキュメントは、同国対決（同一国籍の選手がホーム/アウェイに存在）における選手間の関係性・小ネタ生成のプロンプト仕様を定義する。
共通の制約については [llm_common.md](./llm_common.md) を参照。

## 1. 概要

**目的**: 単なる選手名の羅列ではなく、選手間の関係性（代表チーム、元同僚など）や背景を生成し、レポートの付加価値を高める。

**実装**: `src/clients/llm_client.py` - `generate_same_country_trivia`

## 2. generate_same_country_trivia

**入力データ**:
```json
[
  {
    "country": "Japan",
    "home_players": ["三笘薫"],
    "away_players": ["冨安健洋"]
  }
]
```

**現行プロンプト**:
```
あなたはサッカー専門のトリビアライターです。

以下の同国対決について、選手間の関係性や興味深い事実（小ネタ）を日本語で記述してください。

対決カード:
- 国籍: {country}
- ホームチーム選手 ({home_team}): {home_players}
- アウェイチーム選手 ({away_team}): {away_players}

Requirements:
1. 選手同士の関係性を優先的に記載:
   - 代表チームでの共演
   - 過去のクラブでの同僚関係
   - ユース時代の共演
2. 興味深いトリビアがあれば追加:
   - 同郷、同年齢
   - 過去の対戦エピソード
   - ライバル関係
3. 字数: 50-150字/国
4. 試合結果には絶対に言及しない
5. 確実な事実のみ記載（推測や不確かな情報は避ける）
6. 前置き文は不要、本文のみ

Output Format:
🇯🇵 **日本**
**選手A**（チームA）と**選手B**（チームB）。[関係性・小ネタ]
```

**期待出力例**:
```
🇯🇵 **日本**
**三笘薫**（ブライトン）と**冨安健洋**（アーセナル）。日本代表でのチームメイトで、21年東京五輪でも共に戦った同世代のコンビ。三笘の鋭い左サイド突破を、冨安がどう抑えるかが見どころ。
```

**仕様ポイント**:
- **字数**: 50-150字/国
- **情報源**: LLMの事前知識（外部検索は行わない）
- **制約**: 結果言及禁止、確実性重視

## 3. フォールバック

| 条件 | 挙動 |
|------|------|
| `matchups`が空 | 空文字を返却（セクション非表示） |
| APIエラー | 空文字を返却 |
| モックモード | `[モック: 関係性・小ネタ]` を返却 |

## 4. チューニング方法

`scripts/tuning/tune_same_country.py` を使用する。

```bash
python scripts/tuning/tune_same_country.py \
  --home-team "Brighton" \
  --away-team "Arsenal" \
  --matchups '[{"country": "Japan", "home_players": ["三笘薫"], "away_players": ["冨安健洋"]}]'
```
